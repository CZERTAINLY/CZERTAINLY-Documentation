# Logging Overview

The CZERTAINLY platform consists of multiple components/services that generate logs. The logs are essential for monitoring and troubleshooting the platform. In general, the logs are generated by the following components:

- **Core components** - The core components of the CZERTAINLY platform are the main source of logs. The core components include services that are managing lifecycle of the supported objects (e.g., certificates, keys, etc.), and the services that are providing the platform functionality (e.g., authentication, scheduling, etc.).

- **Connectors** - The connectors are the components that are connecting the CZERTAINLY platform with external systems. The connectors are generating logs for the communication with the external systems. The connector logs are typically outside of the control of the CZERTAINLY platform, and the logs are managed by the external systems.

:::info[Logging guidance]
The logging guidance is provided for the core components of the CZERTAINLY platform. The same guidance can be applied to the connectors, but the configuration and management of the logs are outside of the control of the CZERTAINLY platform.
:::

## Types of logs

The CZERTAINLY platform is generating the following types of logs. You can find detailed information about the logs in the subsequent sections.

| Log type             | Structured                                    | Description                                                                                                                                                                                                                                                                         |
|----------------------|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Application logs** | <span class="badge badge--danger">No</span>   | The application logs are generated to record the events that are affecting the platform. The application logs are used for monitoring and troubleshooting the platform. Its source could be also libraries used by Core.                                                            |
| **Audit logs**       | <span class="badge badge--success">Yes</span> | Audit log records all user operations to reconstruct any event in case of investigation. It also proves the compliance with the various standards and regulations, such as PCI DSS, ISO 27k, GDPR, WebTrust, etc.                                                                   |
| **Event logs**       | <span class="badge badge--success">Yes</span> | Event logs are used to record certificate management, cryptographic key management, and other operation-related events. The transaction logs are used to reconstruct the complete history of the operations and its source can be user or system itself in case of automatic events |

## Logs body structure (Log Record)

Audit logs and event logs body message have specific structure defined by [JSON schema document](!ADD_LINK_HERE!). This ensures that structure of log body is consistent, can be validated and easily parsed by log collectors to work with its information.

| Property            | Type    | Required                                      | Description                                                                                                                     |
|---------------------|---------|-----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| Version             | String  | <span class="badge badge--success">Yes</span> | Version of log structure JSON schema                                                                                            |
| Audited             | Boolean | <span class="badge badge--success">Yes</span> | Flag marking log record as audit log, representing user triggered action                                                        |
| Module              | Enum    | <span class="badge badge--success">Yes</span> | Module where event occured. Represents part or resource of system related to event.                                             |
| Actor               | Object  | <span class="badge badge--success">Yes</span> | Affiliated party or platform component that triggered operation/event                                                           |
| Source              | Object  | <span class="badge badge--danger">No</span>   | Contains request source information like IP address, agent, etc.                                                                |
| Resource            | Object  | <span class="badge badge--success">Yes</span> | Information about resource that is subject of log event                                                                         |
| Affiliated resource | Object  | <span class="badge badge--danger">No</span>   | Information about affiliated resource that acts in event and is related to subject resource (e.g. push certificate to location) | 
| Operation           | Enum    | <span class="badge badge--success">Yes</span> | Operation that is being logged                                                                                                  |
| Operation Result    | Enum    | <span class="badge badge--success">Yes</span> | Operation result which is either success or failed                                                                              |
| Message             | String  | <span class="badge badge--danger">No</span>   | Free form text message to provide additional information, e.g. error message for failed operation result                        |
| Operation Data      | Object  | <span class="badge badge--danger">No</span>   | Structured data based on operation, list of possible properties defined in schema                                               |
| Additional Data     | Map     | <span class="badge badge--danger">No</span>   | Additional key-paired data that can contain debug information or data specific to operation logged                              |


### Modules
- `Approvals`
- `Auth` - Authentication and authorization module, containing also operations for users and roles resources
- `Certificates` - Certificates management and operations including RA profiles and authorities
- `Cryptographic keys` - Cryptographic keys management and operations including tokens and token profiles
- `Compliance`
- `Core` - Module containing core functionality including connectors, credentials and attributes
- `Discovery` - Discovery of different resources
- `Entities` - Entities and locations management
- `Protocols` - Protocols management and operations including protocol profiles
- `Scheduler`
- `Workflows`

### Actor record
Actor object contains following properties:
- **type** - enum with following values
  - `Anonymous`
  - `Core` - (System?)
  - `User`
  - `Connector`
  - `Protocol`
- **auth method** - enum with following values
  - `None`
  - `Certificate`
  - `Token`
  - `API key`
  - `User proxy`
- *uuid* - identification of actor, usually UUID of object representing actor type
- *name* - associated name with actor based on type. For example, username, protocol name, connector name

### Source record
Source object contains following properties:
- method - HTTP method of request
- path - HTTP request path
- content type
- IP address
- user agent

### Resource and Affiliated resource
- **resource** - identification by enum `Resource`
- *uuids* - list of UUIDs, possible more values due to bulk operations
- *names* - list of resource names, possible more values due to bulk operations

**Note**: UUIDs and names lists items on same index correspond to each other.