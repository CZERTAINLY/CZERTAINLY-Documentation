<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-contributors/access-control" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Access control | CZERTAINLY Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.czertainly.com/docs/contributors/access-control"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Access control | CZERTAINLY Documentation"><meta data-rh="true" name="description" content="Authorization is an integral part of CZERTAINLY platform. Each authenticated user and permissions are represented by internal authorization token which is evaluated using Open Policy Agent (OPA) and pre-defined policies. For more information, refer to Access Control."><meta data-rh="true" property="og:description" content="Authorization is an integral part of CZERTAINLY platform. Each authenticated user and permissions are represented by internal authorization token which is evaluated using Open Policy Agent (OPA) and pre-defined policies. For more information, refer to Access Control."><link data-rh="true" rel="icon" href="/img/czertainly_sign_color.svg"><link data-rh="true" rel="canonical" href="https://www.czertainly.com/docs/contributors/access-control"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/contributors/access-control" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/contributors/access-control" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9LVBEQBLSX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="CZERTAINLY Documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.8b2178a1.css">
<script src="/assets/js/runtime~main.4db427c3.js" defer="defer"></script>
<script src="/assets/js/main.45f37ea6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/czertainly_sign_color.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/czertainly_sign_white.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CZERTAINLY Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Core API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/core-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/core-auth/">Auth</a></li><li><a class="dropdown__link" href="/api/core-authority/">Authority</a></li><li><a class="dropdown__link" href="/api/core-certificate/">Certificate</a></li><li><a class="dropdown__link" href="/api/core-client-operations/">Client Operations</a></li><li><a class="dropdown__link" href="/api/core-compliance-profile/">Compliance Profile</a></li><li><a class="dropdown__link" href="/api/core-connector/">Connector</a></li><li><a class="dropdown__link" href="/api/core-credential/">Credential</a></li><li><a class="dropdown__link" href="/api/core-cryptographic-operations/">Cryptographic Operations</a></li><li><a class="dropdown__link" href="/api/core-custom-attributes/">Custom Attributes</a></li><li><a class="dropdown__link" href="/api/core-discovery/">Discovery</a></li><li><a class="dropdown__link" href="/api/core-entity/">Entity</a></li><li><a class="dropdown__link" href="/api/core-group/">Group</a></li><li><a class="dropdown__link" href="/api/core-key/">Key</a></li><li><a class="dropdown__link" href="/api/core-local/">Local</a></li><li><a class="dropdown__link" href="/api/core-location/">Location</a></li><li><a class="dropdown__link" href="/api/core-notification/">Notification</a></li><li><a class="dropdown__link" href="/api/core-other/">Other</a></li><li><a class="dropdown__link" href="/api/core-ra-profile/">RA Profile</a></li><li><a class="dropdown__link" href="/api/core-scep/">SCEP</a></li><li><a class="dropdown__link" href="/api/core-token/">Token</a></li><li><a class="dropdown__link" href="/api/core-token-profile/">Token Profile</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Connector API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/connector-authority-provider-legacy/">Authority Provider Legacy</a></li><li><a class="dropdown__link" href="/api/connector-authority-provider-v2/">Authority Provider v2</a></li><li><a class="dropdown__link" href="/api/connector-compliance-provider/">Compliance Provider</a></li><li><a class="dropdown__link" href="/api/connector-credential-provider/">Credential Provider</a></li><li><a class="dropdown__link" href="/api/connector-cryptography-provider/">Cryptography Provider</a></li><li><a class="dropdown__link" href="/api/connector-discovery-provider/">Discovery Provider</a></li><li><a class="dropdown__link" href="/api/connector-entity-provider/">Entity Provider</a></li><li><a class="dropdown__link" href="/api/connector-notification-provider/">Notification Provider</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Protocol API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/protocol-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/protocol-scep/">SCEP</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/3KeyCompany/CZERTAINLY/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon github-icon"></a><a href="https://discord.gg/XYsSZKjSt4" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon discord-icon"></a><a href="https://www.czertainly.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About CZERTAINLY<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/certificate-key/introduction">Certificates and Cryptographic Keys</a><button aria-label="Expand sidebar category &#x27;Certificates and Cryptographic Keys&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/signing/introduction">Digital Signing</a><button aria-label="Expand sidebar category &#x27;Digital Signing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/feedback-support">Feedback and Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/contributors/overview">Contributors</a><button aria-label="Collapse sidebar category &#x27;Contributors&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/contributors/attributes/overview">Using Attributes</a><button aria-label="Expand sidebar category &#x27;Using Attributes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contributors/database">Database control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/contributors/access-control">Access control</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/qa-strategy/overview">QA Strategy</a><button aria-label="Expand sidebar category &#x27;QA Strategy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/community/overview">Community</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/contributors/overview"><span itemprop="name">Contributors</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Access control</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Access control</h1>
<p>Authorization is an integral part of CZERTAINLY platform. Each authenticated user and permissions are represented by internal authorization token which is evaluated using <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">Open Policy Agent</a> (OPA) and pre-defined policies. For more information, refer to <a href="/docs/certificate-key/concept-design/architecture/access-control/overview">Access Control</a>.</p>
<p>For more information about the definition of authorization policies, refer to <a href="https://github.com/3KeyCompany/CZERTAINLY-Auth-OPA-Policies" target="_blank" rel="noopener noreferrer">CZERTAINLY Auth OPA Policies</a> repository. Individual permissions are set for roles existing in <code>Auth</code> service which then can be assigned to users.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources-and-actions">Resources and actions<a href="#resources-and-actions" class="hash-link" aria-label="Direct link to Resources and actions" title="Direct link to Resources and actions">​</a></h2>
<p><code>Core</code> service works with different types of objects (entities) that are called <strong>resources</strong>. Each resource then has defined set of <strong>actions</strong> that are available for that particular resource. Available resources and actions are defined as <code>enum</code> type to easily refer to.</p>
<table><thead><tr><th>Access Control Enum</th><th>Reference</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td><a href="https://github.com/3KeyCompany/CZERTAINLY-Core/blob/master/src/main/java/com/czertainly/core/model/auth/Resource.java" target="_blank" rel="noopener noreferrer">Resource enum</a></td></tr><tr><td><strong>Actions</strong></td><td><a href="https://github.com/3KeyCompany/CZERTAINLY-Core/blob/master/src/main/java/com/czertainly/core/model/auth/ResourceAction.java" target="_blank" rel="noopener noreferrer">ResourceAction enum</a></td></tr></tbody></table>
<p>The list of available actions for particular resources is dynamically constructed by the <code>Core</code> service based on the <code>@ExternalAuthorization</code> annotation. Continue reading to get more details.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="permissions-object">Permissions object<a href="#permissions-object" class="hash-link" aria-label="Direct link to Permissions object" title="Direct link to Permissions object">​</a></h2>
<p>The permissions object represents set of actions performed on resources that need to be evaluated. It conforms with the JSON data structure and is constructed by the <code>Auth</code> service and evaluated by the <code>OPA</code> service.</p>
<p>Individual permissions can be evaluated on two levels (represented by different OPA policies), generally if action is allowed / denied on:</p>
<ul>
<li>resource level or (<a href="https://github.com/3KeyCompany/CZERTAINLY-Auth-OPA-Policies/blob/develop/policies/method_policy.rego" target="_blank" rel="noopener noreferrer">Method policy</a>)</li>
<li>on object level for specific object UUID. (<a href="https://github.com/3KeyCompany/CZERTAINLY-Auth-OPA-Policies/blob/develop/policies/objects_policy.rego" target="_blank" rel="noopener noreferrer">Objects policy</a>)</li>
</ul>
<p>Example of permissions objects for some resource can be seen on following excerpt from authorization token:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;permissions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;allowAllResources&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;resources&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;raProfiles&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;allowAllActions&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;actions&quot;: [ &quot;detail&quot;, &quot;list&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;objects&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;NG-RA-Profile1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;uuid&quot;: &quot;d7d5b6e6-0335-4492-a994-6120751fced1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;allow&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;deny&quot;: [ &quot;detail&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;certificates&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;allowAllActions&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;actions&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;objects&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example there are permissions defined for two resources:</p>
<ul>
<li><code>raProfiles</code> and</li>
<li><code>certificates</code>.
For <code>certificates</code> resource all actions are allowed and for <code>raProfiles</code> detail and list action on any RA Profile except RA Profile named <em>NG-RA-Profile1</em> where detail action is denied.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>OPA evaluation input</div><div class="admonitionContent_BuS1"><p>You can see <a href="https://github.com/3KeyCompany/CZERTAINLY-Auth-OPA-Policies/blob/master/samples/input.json" target="_blank" rel="noopener noreferrer"><code>input.json</code></a> for a complete input sample for OPA evaluation.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="externalauthorization-annotation"><code>@ExternalAuthorization</code> annotation<a href="#externalauthorization-annotation" class="hash-link" aria-label="Direct link to externalauthorization-annotation" title="Direct link to externalauthorization-annotation">​</a></h2>
<p>Authorization process is triggered by accessing methods annotated with <a href="https://github.com/3KeyCompany/CZERTAINLY-Core/blob/master/src/main/java/com/czertainly/core/security/authz/ExternalAuthorization.java" target="_blank" rel="noopener noreferrer"><code>@ExternalAuthorization</code> annotation</a>. Typically, public methods of service implementations are annotated with this annotation, to require authorization if service is called from anywhere across <code>Core</code> service.</p>
<p>Authorization mechanism itself is driven by <a href="https://docs.spring.io/spring-security/reference/servlet/authorization/architecture.html" target="_blank" rel="noopener noreferrer">Spring framework</a> security layer and custom implementations of <code>AccessDecisionVoter</code>.</p>
<p>For example, voter responsible for evaluating <code>method</code> policies extracts parameters of annotation of method that is being accessed and constructs input to include in request to OPA evaluation. Based on response from <code>OPA</code> service, result can be <code>ACCESS_GRANTED</code> or <code>ACCESS_DENIED</code>.</p>
<p><code>@ExternalAuthorization</code> annotation has parameters to define two pairs of <code>Resource</code> and <code>ResourceAction</code>. One is for resource that is being accessed and the second for parent resource. Both can be evaluated simultaneously to authorize access to resources in hierarchical dependency.
Resource and action names are codes for enums defined in <code>Core</code> service.</p>
<p>To specify parent resource/action is optional and its usage depends on the context, if method requires authorization for more resources. Typically, you can use evaluation of permissions together with parent resource when input of your method are two resources that are hierarchically related (e.g., concept of principal and dependent entities in DB).
But in case access to other resource is in separate corresponding service method, permissions for that resource can be evaluated separately in its own context (service).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Parent resource</div><div class="admonitionContent_BuS1"><p>Even the name parent resource suggests some dependency between resources specified, you can use parent resource / action pair to evaluate any resource pair without any relation.</p></div></div>
<p>For example, method annotated with</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@ExternalAuthorization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RA_PROFILE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DELETE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentResource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">AUTHORITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DETAIL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>means that accessing this method triggers evaluation of permissions for <code>delete</code> action on resource <code>raProfiles</code> and <code>detail</code> action on parent resource <code>authorities</code>. (Note: Between resource <code>raProfiles</code> and parent resource <code>authorities</code> is one-to-many relationship).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="object-access-level-permissions-evaluation">Object access level permissions evaluation<a href="#object-access-level-permissions-evaluation" class="hash-link" aria-label="Direct link to Object access level permissions evaluation" title="Direct link to Object access level permissions evaluation">​</a></h2>
<p>In case we want to evaluate permissions for resource / action on object access level, <code>@ExternalAuthorization</code> annotation is combined with method parameters. Parameter representing UUID of object that should be evaluated needs to be of type <code>SecuredUUID</code>. To evaluate object access level for parent resource / action, we use similarly type <code>SecuredParentUUID</code>.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@ExternalAuthorization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RA_PROFILE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DELETE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentResource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">AUTHORITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DETAIL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">deleteRaProfile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SecuredParentUUID</span><span class="token plain"> authorityUuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">SecuredUUID</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">NotFoundException</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// your code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example above we can see how annotation and method signature should look if we want to evaluate permissions to delete RA Profile object with UUID specified by parameter <code>uuid</code> and permissions to retrieve detail of object of parent resource authority with UUID specified by parameter <code>authorityUuid</code>.</p>
<p>If we have list of UUIDs to evaluate, we can use <code>List&lt;SecuredUuid&gt;</code> type in similar fashion:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@ExternalAuthorization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RA_PROFILE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DELETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bulkDeleteRaProfile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">SecuredUUID</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> uuids</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// your code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Other use case for evaluation object access level permissions is when we want to filter list of retrieved objects to contain only objects that have allowed action specified in the annotation (usually applicable in listing endpoints).</p>
<p>This can be achieved by passing <code>SecurityFilter</code> object to method annotated with <code>@ExternalAuthorization</code>. <code>SecurityFilter</code> contains resource filters (for resource and parent resource from annotation) with list of allowed and denied object UUIDs that are populated with response from OPA <code>object</code> policy evaluation. <code>SecurityFilter</code> can then be used for example to filter out records retrieved from DB.</p>
<p>If you want to automatize retrieving records from database based on <code>SecurityFilter</code>, <code>Core</code> service offers generic implementation of <code>SecurityFilterRepository</code>. Its method <code>findUsingSecurityFilter</code> constructs query with <code>WHERE IN</code> and <code>WHERE NOT IN</code> conditions based on lists of allowed and denied UUIDs in security filter.
In case if parent resource is set, it is necessary to set property of entity (representing resource object) that holds reference UUID for parent resource (DB table column). It can be done by setting <code>parentRefProperty</code> of <code>SecurityFilter</code>.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@ExternalAuthorization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RA_PROFILE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LIST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentResource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">AUTHORITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parentAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ResourceAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LIST</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RaProfileDto</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">listRaProfiles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SecurityFilter</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setParentRefProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;authorityInstanceReferenceUuid&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> securityFilterRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findUsingSecurityFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RaProfile</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">mapToDtoSimple</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">collect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Collectors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, we are using security filter to get filters for RA Profile objects that have permission for list action and their parent resource authority, too. Since <code>SecurityFilterRepository</code> is used to retrieve list of allowed RA profiles based on authorization, <code>parentRefProperty</code> of filter is set to <code>&quot;authorityInstanceReferenceUuid&quot;</code> which contains reference to <code>Authority</code> of <code>RaProfile</code> entity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-are-resource-and-actions-synchronized">How are resource and actions synchronized<a href="#how-are-resource-and-actions-synchronized" class="hash-link" aria-label="Direct link to How are resource and actions synchronized" title="Direct link to How are resource and actions synchronized">​</a></h2>
<p>To achieve that changes in available set of resources and their actions are reflected in role permissions, <code>Core</code> service manages changes automatically with the help of syncing mechanism.</p>
<p>When <code>Core</code> service starts, it collects all <code>@ExternalAuthorization</code> annotation instances and builds map of available resources and their actions. This information is then passed to <code>Auth</code> service which can then store role permissions with reference to corresponding resource/action.</p>
<p>This way, <code>Core</code> and <code>Auth</code> services are in sync and permissions can refer to all resources and actions that are actually used and require authorization.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authendpoint-annotation"><code>@AuthEndpoint</code> annotation<a href="#authendpoint-annotation" class="hash-link" aria-label="Direct link to authendpoint-annotation" title="Direct link to authendpoint-annotation">​</a></h2>
<p>In addition, you can mark resources to allow adding permissions on object access level. It can be achieved by annotating listing endpoint in corresponding <strong>controller</strong> that can be used to list objects. The <a href="https://github.com/3KeyCompany/CZERTAINLY-Core/blob/master/src/main/java/com/czertainly/core/auth/AuthEndpoint.java" target="_blank" rel="noopener noreferrer">annotation <code>@AuthEndpoint</code></a> is used to set object listing endpoint path for a resource which can be later used in permissions editor to dynamically retrieve available objects of that resource.</p>
<p>Example of using <code>@AuthEndpoint</code> annotation to mark RA profile resource to have object access level permissions:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@AuthEndpoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Resource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RA_PROFILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">RaProfileDto</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">listRaProfiles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Optional</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Boolean</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> raProfileService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listRaProfiles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SecurityFilter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Object <code>uuid</code> and <code>name</code> property</div><div class="admonitionContent_BuS1"><p>Entity and DTO that is returned from listing endpoint which is representing resource that has object access level has to contain <code>name</code> property. That way any object can be properly labeled also with human readable name instead of its UUID. Without <code>name</code> property, objects will be identified only through its UUID.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extending-resources-and-actions">Extending resources and actions<a href="#extending-resources-and-actions" class="hash-link" aria-label="Direct link to Extending resources and actions" title="Direct link to Extending resources and actions">​</a></h2>
<p>Finally, when you need to extend set of available resources and / or actions that can be used within platform access control, you need to do the following:</p>
<ul>
<li>add new items to <code>enums</code> specified in <a href="#resources-and-actions">Resources and actions</a></li>
<li>annotate corresponding object listing endpoint with annotation <a href="#authendpoint-annotation"><code>@AuthEndpoint</code></a> to allow setting permissions on objects access level</li>
<li>make sure that entity and response objects from listing endpoint contain <code>name</code> property</li>
<li>implement methods with proper <a href="#externalauthorization-annotation"><code>@ExternalAuthorization</code></a> annotation properties</li>
<li>map parameters of method representing object UUIDs to resources used in annotation by using correct parameter type <code>SecuredUUID</code> / <code>SecuredParentUUID</code> to evaluate <a href="#object-access-level-permissions-evaluation">object access level permissions</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/3KeyCompany/CZERTAINLY-Documentation/edit/documentation/docs/60-contributors/08-access-control.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/contributors/database"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Database control</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/qa-strategy/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">QA Strategy</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resources-and-actions" class="table-of-contents__link toc-highlight">Resources and actions</a></li><li><a href="#permissions-object" class="table-of-contents__link toc-highlight">Permissions object</a></li><li><a href="#externalauthorization-annotation" class="table-of-contents__link toc-highlight"><code>@ExternalAuthorization</code> annotation</a></li><li><a href="#object-access-level-permissions-evaluation" class="table-of-contents__link toc-highlight">Object access level permissions evaluation</a></li><li><a href="#how-are-resource-and-actions-synchronized" class="table-of-contents__link toc-highlight">How are resource and actions synchronized</a></li><li><a href="#authendpoint-annotation" class="table-of-contents__link toc-highlight"><code>@AuthEndpoint</code> annotation</a></li><li><a href="#extending-resources-and-actions" class="table-of-contents__link toc-highlight">Extending resources and actions</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2018 - 2024 CZERTAINLY s.r.o. Built with Docusaurus</div></div></div></footer></div>
</body>
</html>