<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-certificate-key/integration-guides/adfs/configure-adfs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Configure AD FS | CZERTAINLY Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.czertainly.com/docs/certificate-key/integration-guides/adfs/configure-adfs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Configure AD FS | CZERTAINLY Documentation"><meta data-rh="true" name="description" content="To configure AD FS for integration with Keycloak, we need to add a new Relying Party Trust and set up claim issuance policy."><meta data-rh="true" property="og:description" content="To configure AD FS for integration with Keycloak, we need to add a new Relying Party Trust and set up claim issuance policy."><link data-rh="true" rel="icon" href="/img/czertainly_sign_color.svg"><link data-rh="true" rel="canonical" href="https://www.czertainly.com/docs/certificate-key/integration-guides/adfs/configure-adfs"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/certificate-key/integration-guides/adfs/configure-adfs" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/certificate-key/integration-guides/adfs/configure-adfs" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9LVBEQBLSX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="CZERTAINLY Documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.8e760928.css">
<script src="/assets/js/runtime~main.f5905283.js" defer="defer"></script>
<script src="/assets/js/main.1feed874.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/czertainly_sign_color.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/czertainly_sign_white.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CZERTAINLY Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Core API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/core-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/core-auth/">Auth</a></li><li><a class="dropdown__link" href="/api/core-authority/">Authority</a></li><li><a class="dropdown__link" href="/api/core-certificate/">Certificate</a></li><li><a class="dropdown__link" href="/api/core-client-operations/">Client Operations</a></li><li><a class="dropdown__link" href="/api/core-compliance-profile/">Compliance Profile</a></li><li><a class="dropdown__link" href="/api/core-connector/">Connector</a></li><li><a class="dropdown__link" href="/api/core-credential/">Credential</a></li><li><a class="dropdown__link" href="/api/core-cryptographic-operations/">Cryptographic Operations</a></li><li><a class="dropdown__link" href="/api/core-custom-attributes/">Custom Attributes</a></li><li><a class="dropdown__link" href="/api/core-discovery/">Discovery</a></li><li><a class="dropdown__link" href="/api/core-entity/">Entity</a></li><li><a class="dropdown__link" href="/api/core-group/">Group</a></li><li><a class="dropdown__link" href="/api/core-key/">Key</a></li><li><a class="dropdown__link" href="/api/core-local/">Local</a></li><li><a class="dropdown__link" href="/api/core-location/">Location</a></li><li><a class="dropdown__link" href="/api/core-notification/">Notification</a></li><li><a class="dropdown__link" href="/api/core-other/">Other</a></li><li><a class="dropdown__link" href="/api/core-ra-profile/">RA Profile</a></li><li><a class="dropdown__link" href="/api/core-scep/">SCEP</a></li><li><a class="dropdown__link" href="/api/core-token/">Token</a></li><li><a class="dropdown__link" href="/api/core-token-profile/">Token Profile</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Connector API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/connector-authority-provider-legacy/">Authority Provider Legacy</a></li><li><a class="dropdown__link" href="/api/connector-authority-provider-v2/">Authority Provider v2</a></li><li><a class="dropdown__link" href="/api/connector-compliance-provider/">Compliance Provider</a></li><li><a class="dropdown__link" href="/api/connector-credential-provider/">Credential Provider</a></li><li><a class="dropdown__link" href="/api/connector-cryptography-provider/">Cryptography Provider</a></li><li><a class="dropdown__link" href="/api/connector-discovery-provider/">Discovery Provider</a></li><li><a class="dropdown__link" href="/api/connector-entity-provider/">Entity Provider</a></li><li><a class="dropdown__link" href="/api/connector-notification-provider/">Notification Provider</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Protocol API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/protocol-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/protocol-scep/">SCEP</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/3KeyCompany/CZERTAINLY/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon github-icon"></a><a href="https://discord.gg/XYsSZKjSt4" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon discord-icon"></a><a href="https://www.czertainly.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About CZERTAINLY<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/certificate-key/introduction">Certificates and Cryptographic Keys</a><button aria-label="Collapse sidebar category &#x27;Certificates and Cryptographic Keys&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/concept-design/overview">Concept and Design</a><button aria-label="Expand sidebar category &#x27;Concept and Design&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/installation-guide/introduction">Installation Guide</a><button aria-label="Expand sidebar category &#x27;Installation Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/quick-start/overview">Quick Start</a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/protocols/overview">Protocols</a><button aria-label="Expand sidebar category &#x27;Protocols&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/settings/overview">Configuration and Settings</a><button aria-label="Expand sidebar category &#x27;Configuration and Settings&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/connectors/overview">Connectors</a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/integration-guides">Integration Guides</a><button aria-label="Collapse sidebar category &#x27;Integration Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/integration-guides/keycloak/overview">Keycloak Authentication Server</a><button aria-label="Expand sidebar category &#x27;Keycloak Authentication Server&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/integration-guides/intune/overview">Intune Endpoint Management</a><button aria-label="Expand sidebar category &#x27;Intune Endpoint Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/integration-guides/adcs/overview">Active Directory Certificate Services</a><button aria-label="Expand sidebar category &#x27;Active Directory Certificate Services&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/certificate-key/integration-guides/adfs/overview">Active Directory Federation Services</a><button aria-label="Collapse sidebar category &#x27;Active Directory Federation Services&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/integration-guides/adfs/configure-keycloak">Configure Keycloak</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/certificate-key/integration-guides/adfs/configure-adfs">Configure AD FS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/integration-guides/adfs/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/integration-guides/hashicorp-vault/overview">HashiCorp Vault</a><button aria-label="Expand sidebar category &#x27;HashiCorp Vault&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/integration-guides/ejbca-ng-connector/integration-guide">EJBCA NG Connector</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/current-versions">Current Versions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/signing/introduction">Digital Signing</a><button aria-label="Expand sidebar category &#x27;Digital Signing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/feedback-support">Feedback and Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/contributors/overview">Contributors</a><button aria-label="Expand sidebar category &#x27;Contributors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/qa-strategy/overview">QA Strategy</a><button aria-label="Expand sidebar category &#x27;QA Strategy&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/community/overview">Community</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/certificate-key/introduction"><span itemprop="name">Certificates and Cryptographic Keys</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/integration-guides"><span itemprop="name">Integration Guides</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/certificate-key/integration-guides/adfs/overview"><span itemprop="name">Active Directory Federation Services</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configure AD FS</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configure AD FS</h1>
<p>To configure AD FS for integration with Keycloak, we need to add a new Relying Party Trust and set up claim issuance policy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-relying-party-trust">Add Relying Party Trust<a href="#add-relying-party-trust" class="hash-link" aria-label="Direct link to Add Relying Party Trust" title="Direct link to Add Relying Party Trust">​</a></h2>
<p>Open the <em>AD FS Management console</em> on the Windows Server and follow the steps below:</p>
<ol>
<li>Right-click on <strong><code>Trust relationships</code></strong> and select <strong><code>Add Relying Party Trusts...</code></strong> from the context menu.</li>
<li>Select <strong><code>Claims aware</code></strong> and click <strong><code>Start</code></strong>.</li>
<li>Import data about the relying party using URL or manually via file by clicking browse and click <strong><code>Next</code></strong>. You can find the SAML 2.0 service provider metadata URL in the <a href="/docs/certificate-key/integration-guides/adfs/configure-keycloak#export-service-provider-metadata">Keycloak configuration</a>.</li>
<li>Enter the <strong><code>Display name</code></strong> of the new relying party and click <strong><code>Next</code></strong>.</li>
<li>Adjust the <strong><code>Access control Policy</code></strong> to limit users from using the new relying party and click <strong><code>Next</code></strong>.</li>
<li>Review all settings and click <strong><code>Next</code></strong>.</li>
<li>Keep the <strong><code>Configure claims issuance policy for this application</code></strong> checkbox checked and click <strong><code>Close</code></strong> to add the new relying party trust.</li>
</ol>
<center><div style="width:80%"><p><img decoding="async" loading="lazy" alt="AD FS console" src="/assets/images/adfs-console-e587b3b3c61f5e404ad1f6c3d5711c6b.png" width="972" height="390" class="img_ev3q"></p></div></center>
<p>The new relying party trust is now added to the list of relying party trusts. Users can authenticate using the new relying party trust, however, no user attributes are sent to the service provider. For that, we need to set up claim mapping.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-claim-issuance-policy">Setup claim issuance policy<a href="#setup-claim-issuance-policy" class="hash-link" aria-label="Direct link to Setup claim issuance policy" title="Direct link to Setup claim issuance policy">​</a></h2>
<p>Open the <em>AD FS Management console</em> on the Windows Server. In the list of <strong><code>Relying Party Trusts</code></strong> right-click on the relying party and from the context menu select <strong><code>Edit claim Issuance Policy...</code></strong> to open the editor. Configure the following rules:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="name-id">Name ID<a href="#name-id" class="hash-link" aria-label="Direct link to Name ID" title="Direct link to Name ID">​</a></h3>
<ol>
<li>Click on <strong><code>Add Rule...</code></strong> to open the <strong><code>Add Transform Claim Rule Wizard</code></strong>.</li>
<li>Select <strong><code>Transform an Incoming Claim</code></strong> and click <strong><code>Next</code></strong>.</li>
<li>Enter the <strong><code>Claim rule name</code></strong> as <code>Name ID</code>.</li>
<li>Select <strong><code>Windows Account Name</code></strong> as the <strong><code>Incoming claim type</code></strong> and <strong><code>Name ID</code></strong> as the <strong><code>Outgoing claim type</code></strong>.</li>
<li>Select <strong><code>Outgoing name ID format</code></strong> as <strong><code>Windows Qualified Domain Name</code></strong> and click <strong><code>Finish</code></strong>.</li>
</ol>
<p>This rule will provide claims about the user&#x27;s name in the format <code>username/domain</code>.</p>
<center><div style="width:80%"><p><img decoding="async" loading="lazy" alt="AD FS claim Name ID" src="/assets/images/claim-adfs-name-id-e93abc90b57547910df1173f019435d7.png" width="549" height="590" class="img_ev3q"></p></div></center>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-attributes">User attributes<a href="#user-attributes" class="hash-link" aria-label="Direct link to User attributes" title="Direct link to User attributes">​</a></h3>
<ol>
<li>Click on <strong><code>Add Rule...</code></strong> to open the <strong><code>Add Transform Claim Rule Wizard</code></strong>.</li>
<li>Select <strong><code>Send LDAP Attributes as Claims</code></strong> and click <strong><code>Next</code></strong>.</li>
<li>Enter the <strong><code>Claim rule name</code></strong> as <code>User attributes</code>.</li>
<li>Select <strong><code>Active Directory</code></strong> as the <strong><code>Attribute store</code></strong>.</li>
<li>Select the <strong><code>LDAP Attribute</code></strong> as <strong><code>E-Mail-Addresses</code></strong> and the <strong><code>Outgoing Claim Type</code></strong> as <strong><code>E-Mail Address</code></strong>.</li>
<li>Select the <strong><code>LDAP Attribute</code></strong> as <strong><code>Given-Name</code></strong> and the <strong><code>Outgoing Claim Type</code></strong> as <strong><code>Given Name</code></strong>.</li>
<li>Select the <strong><code>LDAP Attribute</code></strong> as <strong><code>Surname</code></strong> and the <strong><code>Outgoing Claim Type</code></strong> as <strong><code>Surname</code></strong>.</li>
<li>Click <strong><code>Finish</code></strong>.</li>
</ol>
<p>This rule will provide claims about the user&#x27;s email address, given name, and surname from the Active Directory data.</p>
<center><div style="width:80%"><p><img decoding="async" loading="lazy" alt="AD FS claim User attribute" src="/assets/images/claim-adfs-user-attributes-5073a08e7a526068cda9d9d47664f632.png" width="549" height="590" class="img_ev3q"></p></div></center>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="group-membership">Group membership<a href="#group-membership" class="hash-link" aria-label="Direct link to Group membership" title="Direct link to Group membership">​</a></h3>
<ol>
<li>Click on <strong><code>Add Rule...</code></strong> to open the <strong><code>Add Transform Claim Rule Wizard</code></strong>.</li>
<li>Select <strong><code>Send Group Membership as a Claim</code></strong> and click <strong><code>Next</code></strong>.</li>
<li>Enter the <strong><code>Claim rule name</code></strong> as <code>Group membership: admin</code>. Change the name according to the group you want to send.</li>
<li>Select user&#x27;s group using <strong><code>Browse...</code></strong> button.</li>
<li>Select <strong><code>Group</code></strong> as the <strong><code>Outgoing claim type</code></strong>.</li>
<li>Select the <strong><code>Outgoing claim value</code></strong> as the the associated name of the role in the CZERTAINLY platform, for example <strong><code>admin</code></strong>.</li>
<li>Click <strong><code>Finish</code></strong>.</li>
</ol>
<p>This rule will provide claims about the user&#x27;s group membership in the format of the group name.</p>
<center><div style="width:80%"><p><img decoding="async" loading="lazy" alt="AD FS claim Group" src="/assets/images/claim-adfs-group-b4fe74d1ed4f056909d9da7702e23ffc.png" width="549" height="590" class="img_ev3q"></p></div></center>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Group membership</div><div class="admonitionContent_BuS1"><p>The group membership rule will provide claims about the user&#x27;s group membership only in case the user is a member of the selected group. If you want to provide claims about multiple groups, you need to create a separate rule for each group. The group name should match the role name in the CZERTAINLY platform, or it will be created as a new role, depending on the platform configuration.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="powershell-configuration">PowerShell configuration<a href="#powershell-configuration" class="hash-link" aria-label="Direct link to PowerShell configuration" title="Direct link to PowerShell configuration">​</a></h2>
<p>You can use PowerShell to automate the configuration of the AD FS relying party trust and claim issuance policy. The following script will add a new relying party trust and configure claim issuance policy for the new relying party trust. Change the <code>$metadataUrl</code>, <code>$relyingPartyName</code>, and <code>$accessControlPolicy</code> variables to match your environment.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add new relying party trust</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$metadataUrl</span><span class="token plain"> = </span><span class="token string" style="color:#e3116c">&quot;https://keycloak.example.com/realms/CZERTAINLY/broker/adfs-idp-alias/endpoint/descriptor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$relyingPartyName</span><span class="token plain"> = </span><span class="token string" style="color:#e3116c">&quot;CZERTAINLY&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$accessControlPolicyName</span><span class="token plain"> = </span><span class="token string" style="color:#e3116c">&quot;Permit everyone&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$relyingPartyTrust</span><span class="token plain"> = </span><span class="token function" style="color:#d73a49">Add-AdfsRelyingPartyTrust</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">MetadataUrl </span><span class="token variable" style="color:#36acaa">$metadataUrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Name </span><span class="token variable" style="color:#36acaa">$relyingPartyName</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">AccessControlPolicyName </span><span class="token variable" style="color:#36acaa">$accessControlPolicy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the group SID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$groupSid</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">Get-ADGroup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">Filter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Name </span><span class="token operator" style="color:#393A34">-eq</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Administrators&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SID</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Configure claim issuance policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$stringClaimRule</span><span class="token plain"> = @</span><span class="token string" style="color:#e3116c">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleTemplate = &quot;MapClaims&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleName = &quot;Name ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> =&gt; issue(Type = &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&quot;, Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType, Properties[&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format&quot;] = &quot;urn:oasis:names:tc:SAML:1.1:nameid-format:WindowsDomainQualifiedName&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleTemplate = &quot;LdapClaims&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleName = &quot;User attributes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;, Issuer == &quot;AD AUTHORITY&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> =&gt; issue(store = &quot;Active Directory&quot;, types = (&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;, &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname&quot;, &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname&quot;), query = &quot;;mail,givenName,sn;{0}&quot;, param = c.Value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleTemplate = &quot;EmitGroupClaims&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@RuleName = &quot;Group membership: admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid&quot;, Value == &quot;$groupSid&quot;, Issuer == &quot;AD AUTHORITY&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> =&gt; issue(Type = &quot;http://schemas.xmlsoap.org/claims/Group&quot;, Value = &quot;admin&quot;, Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, ValueType = c.ValueType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain">@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$stringClaimRule</span><span class="token plain"> = </span><span class="token variable" style="color:#36acaa">$stringClaimRule</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;$groupSid&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$groupSid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$issuancerules</span><span class="token plain"> = </span><span class="token function" style="color:#d73a49">New-AdfsClaimRuleSet</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ClaimRule </span><span class="token variable" style="color:#36acaa">$stringClaimRule</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get relying party trust</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$relyingparty</span><span class="token plain"> = </span><span class="token function" style="color:#d73a49">Get-ADFSRelyingPartyTrust</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Name </span><span class="token variable" style="color:#36acaa">$relyingPartyName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Set claim issuance policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Set-AdfsRelyingPartyTrust</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">TargetName </span><span class="token variable" style="color:#36acaa">$relyingParty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">IssuanceTransformRules </span><span class="token variable" style="color:#36acaa">$issuancerules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClaimRulesString</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/3KeyCompany/CZERTAINLY-Documentation/edit/documentation/docs/10-certificate-key/20-integration-guides/18-adfs/30-configure-adfs.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/certificate-key/integration-guides/adfs/configure-keycloak"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configure Keycloak</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/certificate-key/integration-guides/adfs/troubleshooting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Troubleshooting</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-relying-party-trust" class="table-of-contents__link toc-highlight">Add Relying Party Trust</a></li><li><a href="#setup-claim-issuance-policy" class="table-of-contents__link toc-highlight">Setup claim issuance policy</a><ul><li><a href="#name-id" class="table-of-contents__link toc-highlight">Name ID</a></li><li><a href="#user-attributes" class="table-of-contents__link toc-highlight">User attributes</a></li><li><a href="#group-membership" class="table-of-contents__link toc-highlight">Group membership</a></li></ul></li><li><a href="#powershell-configuration" class="table-of-contents__link toc-highlight">PowerShell configuration</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2018 - 2024 CZERTAINLY s.r.o. Built with Docusaurus</div></div></div></footer></div>
</body>
</html>