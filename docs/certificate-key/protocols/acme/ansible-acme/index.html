<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-certificate-key/protocols/acme/ansible-acme" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Ansible acme module | CZERTAINLY Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.czertainly.com/docs/certificate-key/protocols/acme/ansible-acme"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ansible acme module | CZERTAINLY Documentation"><meta data-rh="true" name="description" content="Ansible is a suite of tools to enable the automatization of software configuration. It can be used in conjunction with an ACME server running on the CZERTAINLY platform to automate certificate management, especially in situations where a target entity isn&#x27;t capable of certificate management operations and direct communication with an ACME server through available ACME client implementations."><meta data-rh="true" property="og:description" content="Ansible is a suite of tools to enable the automatization of software configuration. It can be used in conjunction with an ACME server running on the CZERTAINLY platform to automate certificate management, especially in situations where a target entity isn&#x27;t capable of certificate management operations and direct communication with an ACME server through available ACME client implementations."><link data-rh="true" rel="icon" href="/img/czertainly_sign_color.svg"><link data-rh="true" rel="canonical" href="https://www.czertainly.com/docs/certificate-key/protocols/acme/ansible-acme"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/certificate-key/protocols/acme/ansible-acme" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.czertainly.com/docs/certificate-key/protocols/acme/ansible-acme" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9LVBEQBLSX-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="CZERTAINLY Documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.8e760928.css">
<script src="/assets/js/runtime~main.87405d64.js" defer="defer"></script>
<script src="/assets/js/main.f2187920.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/czertainly_sign_color.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/czertainly_sign_white.svg" alt="CZERTAINLY Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CZERTAINLY Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Core API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/core-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/core-auth/">Auth</a></li><li><a class="dropdown__link" href="/api/core-authority/">Authority</a></li><li><a class="dropdown__link" href="/api/core-certificate/">Certificate</a></li><li><a class="dropdown__link" href="/api/core-client-operations/">Client Operations</a></li><li><a class="dropdown__link" href="/api/core-compliance-profile/">Compliance Profile</a></li><li><a class="dropdown__link" href="/api/core-connector/">Connector</a></li><li><a class="dropdown__link" href="/api/core-credential/">Credential</a></li><li><a class="dropdown__link" href="/api/core-cryptographic-operations/">Cryptographic Operations</a></li><li><a class="dropdown__link" href="/api/core-custom-attributes/">Custom Attributes</a></li><li><a class="dropdown__link" href="/api/core-discovery/">Discovery</a></li><li><a class="dropdown__link" href="/api/core-entity/">Entity</a></li><li><a class="dropdown__link" href="/api/core-group/">Group</a></li><li><a class="dropdown__link" href="/api/core-key/">Key</a></li><li><a class="dropdown__link" href="/api/core-local/">Local</a></li><li><a class="dropdown__link" href="/api/core-location/">Location</a></li><li><a class="dropdown__link" href="/api/core-notification/">Notification</a></li><li><a class="dropdown__link" href="/api/core-other/">Other</a></li><li><a class="dropdown__link" href="/api/core-ra-profile/">RA Profile</a></li><li><a class="dropdown__link" href="/api/core-scep/">SCEP</a></li><li><a class="dropdown__link" href="/api/core-token/">Token</a></li><li><a class="dropdown__link" href="/api/core-token-profile/">Token Profile</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Connector API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/connector-authority-provider-legacy/">Authority Provider Legacy</a></li><li><a class="dropdown__link" href="/api/connector-authority-provider-v2/">Authority Provider v2</a></li><li><a class="dropdown__link" href="/api/connector-compliance-provider/">Compliance Provider</a></li><li><a class="dropdown__link" href="/api/connector-credential-provider/">Credential Provider</a></li><li><a class="dropdown__link" href="/api/connector-cryptography-provider/">Cryptography Provider</a></li><li><a class="dropdown__link" href="/api/connector-discovery-provider/">Discovery Provider</a></li><li><a class="dropdown__link" href="/api/connector-entity-provider/">Entity Provider</a></li><li><a class="dropdown__link" href="/api/connector-notification-provider/">Notification Provider</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Protocol API</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/protocol-acme/">ACME</a></li><li><a class="dropdown__link" href="/api/protocol-scep/">SCEP</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/3KeyCompany/CZERTAINLY/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon github-icon"></a><a href="https://discord.gg/XYsSZKjSt4" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon discord-icon"></a><a href="https://www.czertainly.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About CZERTAINLY<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/certificate-key/introduction">Certificates and Cryptographic Keys</a><button aria-label="Collapse sidebar category &#x27;Certificates and Cryptographic Keys&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/concept-design/overview">Concept and Design</a><button aria-label="Expand sidebar category &#x27;Concept and Design&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/installation-guide/introduction">Installation Guide</a><button aria-label="Expand sidebar category &#x27;Installation Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/quick-start/overview">Quick Start</a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/certificate-key/protocols/overview">Protocols</a><button aria-label="Collapse sidebar category &#x27;Protocols&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/certificate-key/protocols/acme/overview">ACME</a><button aria-label="Collapse sidebar category &#x27;ACME&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/acme-profile">ACME Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/acme-account">ACME Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/enable-acme">Enable ACME</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/cert-manager">Kubernetes cert-manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/certbot">Certbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/win-acme">IIS win-acme</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/protocols/acme/terraform">Terraform acme provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/certificate-key/protocols/acme/ansible-acme">Ansible acme module</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/protocols/scep/overview">SCEP</a><button aria-label="Expand sidebar category &#x27;SCEP&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/settings/overview">Configuration and Settings</a><button aria-label="Expand sidebar category &#x27;Configuration and Settings&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/certificate-key/connectors/overview">Connectors</a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/integration-guides">Integration Guides</a><button aria-label="Expand sidebar category &#x27;Integration Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-key/current-versions">Current Versions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/signing/introduction">Digital Signing</a><button aria-label="Expand sidebar category &#x27;Digital Signing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/feedback-support">Feedback and Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/contributors/overview">Contributors</a><button aria-label="Expand sidebar category &#x27;Contributors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/qa-strategy/overview">QA Strategy</a><button aria-label="Expand sidebar category &#x27;QA Strategy&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/community/overview">Community</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/certificate-key/introduction"><span itemprop="name">Certificates and Cryptographic Keys</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/certificate-key/protocols/overview"><span itemprop="name">Protocols</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/certificate-key/protocols/acme/overview"><span itemprop="name">ACME</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ansible acme module</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="ansible-acme-module">Ansible acme module</h1>
<p><a href="https://www.ansible.com/">Ansible</a> is a suite of tools to enable the automatization of software configuration. It can be used in conjunction with an ACME server running on the CZERTAINLY platform to automate certificate management, especially in situations where a target entity isn&#x27;t capable of certificate management operations and direct communication with an ACME server through available ACME client implementations.</p>
<p>CZERTAINLY platform supports ACME implementation according to the <a href="https://datatracker.ietf.org/doc/html/rfc8555">RFC 8555</a>. This guide shows, how you can use Ansible <code>acme</code> module to manage certificates using ACME protocol and certificate management services controlled by the platform.</p>
<p>For more information about Ansible, refer to the <a href="https://docs.ansible.com/">Ansible documentation</a>.</p>
<admonition type="info"><p>This guide assumes you have at least basic knowledge about Ansible. If you are new to Ansible, we recommend you to start with the <a href="https://docs.ansible.com/ansible/latest/getting_started/index.html">Getting started with Ansible</a>.</p></admonition>
<h2 id="prerequisites">Prerequisites</h2>
<p>To use Ansible with CZERTAINLY, you need to have the following:</p>
<ul>
<li>Ansible installed</li>
<li>Configured at least one <code>RA Profile</code> certificate service in CZERTAINLY</li>
<li>Access to HTTP or DNS resources that will be used to validate ACME challenges</li>
<li>ACME protocol enabled according to the <a href="enable-acme">Enable ACME</a></li>
</ul>
<p>To install Ansible, follow the <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">installation instructions</a>.</p>
<h2 id="steps">Steps</h2>
<p>To get a certificate with ACME protocol, you need to do several tasks typically using Ansible:</p>
<ul>
<li>register an account on the ACME server</li>
<li>prepare CSR to issue new certificate</li>
<li>request challenge on the ACME server</li>
<li>transport challenge data to HTTP or DNS server</li>
<li>request validation of the challenge on the ACME server</li>
<li>install the new certificate</li>
</ul>
<h3 id="ansible-playbook-preparation">Ansible playbook preparation</h3>
<p>To demonstrate all steps, we will create a playbook file <a href="https://github.com/semik/ansible-acme-demo/blob/main/playbook-czertainly-acme-demo.yml"><code>playbook-czertainly-acme-demo.yml</code></a>.</p>
<p>The playbook uses the following modules:</p>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/acme_account_module.html"><code>community.crypto.acme_account</code></a> for registration ACME account</li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/acme_certificate_module.html"><code>community.crypto.acme_certificate</code></a> for certificate management operations on ACME server</li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/openssl_privatekey_module.html"><code>community.crypto.openssl_privatekey</code></a> to generate unique key pair</li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/openssl_csr_module.html"><code>community.crypto.openssl_csr</code></a> to sign certificate signing request</li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/community/general/nsupdate_module.html"><code>community.general.nsupdate</code></a> to distribute ACME challenge to DNS server</li>
</ul>
<p>Even though Ansible community manages those modules, they are part of the standard Ansible packages.</p>
<p>At the beginning of the playbook file, we define default values that are used across tasks. The example playbook assumes that it is running on an HTTP server and that user running it has write permissions to <code>/var/www/html</code> directory. All working files and resulting certificate is stored in the <code>tmp</code> directory, which must be created before executing the playbook.</p>
<pre><code class="language-yaml">- name: CZERTAINLY Ansible ACME example
  hosts: localhost

  tasks:
    - name: Set vars
      ansible.builtin.set_fact:
        acme_directory: &quot;https://[domain]:[port]/api/v1/protocols/acme/czertainly/directory&quot;
        acme_version: 2
        acme_register_account: true
        acme_web_dir: &quot;/var/www/html&quot;
        acme_force: false
        acme_account_email: &quot;email@example.com&quot;
        bind: &quot;{{ lookup(&#x27;file&#x27;, &#x27;vars/czertainly.private&#x27;) | from_yaml }}&quot;

    - name: Set default ACME method
      ansible.builtin.set_fact:
        acme_method: &#x27;http-01&#x27;
        when: acme_method is not defined
</code></pre>
<h3 id="register-acme-account">Register ACME account</h3>
<p>First, we will create private RSA key pair which will be associated with later registered account. The key can be used for revoking the issued certificate even when the private key of the certificate isn&#x27;t available.</p>
<pre><code class="language-yaml">    - name: Generate private key for ACME account
      community.crypto.openssl_privatekey:
        path: &quot;tmp/acme_account_key&quot;
        type: RSA
        size: 2048
        mode: 0600

    - name: Register ACME Account without external binding
      community.crypto.acme_account:
        account_key_src: &quot;tmp/acme_account_key&quot;
        acme_directory: &quot;{{ acme_directory }}&quot;
        acme_version: &quot;{{ acme_version }}&quot;
        state: present
        terms_agreed: true
        contact:
          - &quot;mailto:{{ acme_account_email }}&quot;
      register: acme_account
      when: acme_register_account
</code></pre>
<h3 id="generate-private-key-and-prepare-csr">Generate private key and prepare CSR</h3>
<p>The step to generate key pair and certificate signing request is optional. You can also you externally generated and signed certificate signing request.</p>
<admonition title="Account vs certificate key pair" type="note"><p>Note that this key pair is not associated with the ACME account key pair.</p></admonition>
<pre><code class="language-yaml">    - name: Generate private key for server
      community.crypto.openssl_privatekey:
        path: &quot;tmp/{{ acme_domain }}.key&quot;
        type: RSA
        size: 2048
        mode: 0600

    - name: Generate certificate signing request (CSR)
      community.crypto.openssl_csr:
        path: &quot;tmp/{{ acme_domain }}.csr&quot;
        privatekey_path: &quot;tmp/{{ acme_domain }}.key&quot;
        common_name: &quot;{{ acme_domain }}&quot;
        subject_alt_name: &quot;DNS:{{ acme_domain }}&quot;
</code></pre>
<h3 id="request-verification-challenge">Request verification challenge</h3>
<p>Now, we need to submit the certificate signing request to ACME server and register validation challenge.. The argument <code>dest</code> can be pointing to a non-existent file. But if it points to an existing certificate, the Ansible will check if it is below the default value 10 days and request renewal instead of new certificate (default behaviour). This can be modified by arguments <code>remaining_days</code> and <code>force</code>. The second argument, <code>force</code> requests new certificate every time the playbook is executed, instead of checking for renewal.</p>
<pre><code class="language-yaml">    - name: Create a challenge
      community.crypto.acme_certificate:
        account_key_src: &quot;tmp/acme_account_key&quot;
        account_email: &quot;{{ acme_account_email }}&quot;
        csr: &quot;tmp/{{ acme_domain }}.csr&quot;
        dest: &quot;tmp/{{ acme_domain }}}.crt&quot;
        acme_directory: &quot;{{ acme_directory }}&quot;
        acme_version: &quot;{{ acme_version }}&quot;
        terms_agreed: true
        force: &quot;{{ acme_force }}&quot;
        modify_account: false
        challenge: &quot;{{ acme_method }}&quot;
      register: acme_challenge

    - name: Show challenge
      ansible.builtin.debug: var=acme_challenge
</code></pre>
<p>The following is an example of challenge data generated by CZERTAINLY for submitted CSR containing with two domain name identifiers <code>demo.czertainly.test</code> and <code>www.czertainly.test</code>:</p>
<pre><code class="language-json">  &quot;challenge_data&quot;: {
     &quot;demo.czertainly.test&quot;: {
        &quot;dns-01&quot;: {
           &quot;record&quot;: &quot;_acme-challenge.demo.czertainly.test&quot;,
           &quot;resource&quot;: &quot;_acme-challenge&quot;,
           &quot;resource_value&quot;: &quot;A1RnPLUigrrhd32tDtnF3yH_mgmuDLIfxKvBVrWefs4&quot;
        },
        &quot;http-01&quot;: {
           &quot;resource&quot;: &quot;.well-known/acme-challenge/wXKY9aI5ChnUFGgUzG-dUDe85-Grq4Ub1MGZ2cYVtL4&quot;,
           &quot;resource_value&quot;: &quot;wXKY9aI5ChnUFGgUzG-dUDe85-Grq4Ub1MGZ2cYVtL4.YS1M_PeBjPbe78-TEhNKOWuckVy7xf04IG0HpKijyPw&quot;
        },
     },
     &quot;www.czertainly.test&quot;: {
        &quot;dns-01&quot;: {
           &quot;record&quot;: &quot;_acme-challenge.www.czertainly.test&quot;,
           &quot;resource&quot;: &quot;_acme-challenge&quot;,
           &quot;resource_value&quot;: &quot;_UuzUAyxd1tFA3qx8k94HLmbLwV1Hsoqgef3YxhkWss&quot;
        },
        &quot;http-01&quot;: {
           &quot;resource&quot;: &quot;.well-known/acme-challenge/OSu7SStl_kwYUOQ1dg0jzptGuaHf5VVcPiJyt-8oUMA&quot;,
           &quot;resource_value&quot;: &quot;OSu7SStl_kwYUOQ1dg0jzptGuaHf5VVcPiJyt-8oUMA.YS1M_PeBjPbe78-TEhNKOWuckVy7xf04IG0HpKijyPw&quot;
        },
     }
  }
</code></pre>
<h3 id="publishing-verification-challenge">Publishing verification challenge</h3>
<p>In case you decide to use <code>http-01</code> challenge validation method, you need to publish generated challenge in <code>/var/www/html/.well-known/acme-challenge/</code> directory of the web server:</p>
<pre><code class="language-yaml">    - name: Copy http-01 challenge data
      ansible.builtin.copy:
        dest: &quot;{{ acme_web_dir }}/{{ item.value[&#x27;http-01&#x27;][&#x27;resource&#x27;] }}&quot;
        content: &quot;{{ item.value[&#x27;http-01&#x27;][&#x27;resource_value&#x27;] }}&quot;
      with_dict:
        - &quot;{{ acme_challenge[&#x27;challenge_data&#x27;] }}&quot;
      when: acme_method == &#x27;http-01&#x27;
</code></pre>
<admonition title="Multiple identifiers" type="note"><p>Note a loop using <code>with_dict</code> to iterate over all identifiers.</p></admonition>
<p>In case you decide to use <code>dns-01</code> challenge validation method, you need to publish TXT record to the DNS server responsible for the respective domain. Typically, access is granted based on the secret key that needs to be configured to sign request to write DNS records. Put your DNS credentials into file <code>vars/czertainly.private</code> with the following content:</p>
<pre><code class="language-yaml">server: 123.123.123.123
key_algorithm: &quot;hmac-sha512&quot;
key_name: &quot;name&quot;
key_secret: &quot;base64 data of secret&quot;
</code></pre>
<p>The file <code>vars/czertainly.private</code> gets loaded every time the playbook is executed. The following Ansible task is responsible for publishing the challenge to desired DNS resolver:</p>
<pre><code class="language-yaml">      community.general.nsupdate:
        key_algorithm: &quot;{{ bind.key_algorithm }}&quot;
        key_name: &quot;{{ bind.key_name }}&quot;
        key_secret: &quot;{{ bind.key_secret }}&quot;
        server: &quot;{{ bind.server }}&quot;
        record: &quot;{{ item.value[&#x27;dns-01&#x27;][&#x27;record&#x27;] }}.&quot;
        type: &quot;TXT&quot;
        value: &quot;{{ item.value[&#x27;dns-01&#x27;][&#x27;resource_value&#x27;] | regex_replace(&#x27;^(.*)$&#x27;, &#x27;\&quot;\\1\&quot;&#x27;) }}&quot;
        state: present
      with_dict:
        - &quot;{{ acme_challenge[&#x27;challenge_data&#x27;] }}&quot;
      when: acme_method == &#x27;dns-01&#x27;
</code></pre>
<admonition title="DNS dot notation" type="note"><p>Note dot <code>.</code> after <code>record</code> (DNS name) - it is required for some DNS server implementations, for example Bind9.</p></admonition>
<h3 id="request-validation">Request validation</h3>
<p>Once the challenges are successfully published, Ansible can request CZERTAINLY to validate them:</p>
<pre><code class="language-yaml">    - name: Let the challenge(s) be validated and retrieve the cert and intermediate certificate
      community.crypto.acme_certificate:
        account_key_src: &quot;tmp/acme_account_key&quot;
        csr: &quot;tmp/{{ acme_domain }}.csr&quot;
        dest: &quot;tmp/{{ acme_domain }}.crt&quot;
        fullchain_dest: &quot;tmp/{{ acme_domain }}-fullchain.crt&quot;
        chain_dest: &quot;tmp/{{ acme_domain }}-intermediate.crt&quot;
        data: &quot;{{ acme_challenge }}&quot;
        acme_directory: &quot;{{ acme_directory }}&quot;
        acme_version: &quot;{{ acme_version }}&quot;
        terms_agreed: true
        force: &quot;{{ acme_force }}&quot;
        modify_account: false
        challenge: &quot;{{ acme_method }}&quot;
      async: 120
</code></pre>
<p>This tasks is blocking and can take be time-consuming depending on how many challenges and how often are validated. Therefore, it is a good practice to set timeout for this task. With <code>async: 120</code>, Ansible will wait for 2 minutes for challenge validation, and if it is not done even after this timeout, it will fail with an error.</p>
<h3 id="delete-validation-challenges">Delete validation challenges</h3>
<p>After successful challenge validation and obtaining issued certificate, we are going to do the cleanup:</p>
<pre><code class="language-yaml">    - name: Clean http-01 challenge data from drive
      ansible.builtin.file:
        path: &quot;{{ acme_web_dir }}/{{ item.value[&#x27;http-01&#x27;].resource }}&quot;
        state: absent
      with_dict:
        - &quot;{{ acme_challenge[&#x27;challenge_data&#x27;] }}&quot;
      when: acme_method == &#x27;http-01&#x27;

    - name: Clean dns-01 challenge data from DNS
      community.general.nsupdate:
        key_algorithm: &quot;{{ bind.key_algorithm }}&quot;
        key_name: &quot;{{ bind.key_name }}&quot;
        key_secret: &quot;{{ bind.key_secret }}&quot;
        server: &quot;{{ bind.server }}&quot;
        record: &quot;{{ item.value[&#x27;dns-01&#x27;].record }}.&quot;
        type: &quot;TXT&quot;
        state: absent
      with_dict:
        - &quot;{{ acme_challenge[&#x27;challenge_data&#x27;] }}&quot;
      when: acme_method == &#x27;dns-01&#x27;
</code></pre>
<h3 id="issued-certificate">Issued certificate</h3>
<p>The issued certificate is placed into file <code>&quot;tmp/{{ acme_domain }}.crt&quot;</code>. Placing it in the right location is specific and different for various end entities. This is out of the scope of this guide.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/3KeyCompany/CZERTAINLY-Documentation/edit/documentation/docs/10-certificate-key/07-protocols/02-acme/25-ansible-acme.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/certificate-key/protocols/acme/terraform"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Terraform acme provider</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/certificate-key/protocols/scep/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a><ul><li><a href="#ansible-playbook-preparation" class="table-of-contents__link toc-highlight">Ansible playbook preparation</a></li><li><a href="#register-acme-account" class="table-of-contents__link toc-highlight">Register ACME account</a></li><li><a href="#generate-private-key-and-prepare-csr" class="table-of-contents__link toc-highlight">Generate private key and prepare CSR</a></li><li><a href="#request-verification-challenge" class="table-of-contents__link toc-highlight">Request verification challenge</a></li><li><a href="#publishing-verification-challenge" class="table-of-contents__link toc-highlight">Publishing verification challenge</a></li><li><a href="#request-validation" class="table-of-contents__link toc-highlight">Request validation</a></li><li><a href="#delete-validation-challenges" class="table-of-contents__link toc-highlight">Delete validation challenges</a></li><li><a href="#issued-certificate" class="table-of-contents__link toc-highlight">Issued certificate</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2018 - 2024 CZERTAINLY s.r.o. Built with Docusaurus</div></div></div></footer></div>
</body>
</html>