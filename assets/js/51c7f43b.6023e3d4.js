"use strict";(self.webpackChunkczertainly=self.webpackChunkczertainly||[]).push([[4586],{41699:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var n=i(85893),s=i(11151);const r={},o="Create User",c={id:"certificate-key/integration-guides/adcs/create-user",title:"Create User",description:"Create a user in Active Directory and assign the user with necessary permissions by adding the user to the respective groups as per your use case.",source:"@site/docs/10-certificate-key/20-integration-guides/14-adcs/11-create-user.md",sourceDirName:"10-certificate-key/20-integration-guides/14-adcs",slug:"/certificate-key/integration-guides/adcs/create-user",permalink:"/docs/certificate-key/integration-guides/adcs/create-user",draft:!1,unlisted:!1,editUrl:"https://github.com/3KeyCompany/CZERTAINLY-Documentation/edit/documentation/docs/10-certificate-key/20-integration-guides/14-adcs/11-create-user.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Firewall Configuration",permalink:"/docs/certificate-key/integration-guides/adcs/firewall-configuration"},next:{title:"Testing Integration",permalink:"/docs/certificate-key/integration-guides/adcs/test-integration"}},a={},d=[{value:"Allow user to connect through WinRM",id:"allow-user-to-connect-through-winrm",level:2},{value:"Active Directory permissions",id:"active-directory-permissions",level:2},{value:"ADCS permissions",id:"adcs-permissions",level:2}];function u(e){const t={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"create-user",children:"Create User"}),"\n",(0,n.jsx)(t.p,{children:"Create a user in Active Directory and assign the user with necessary permissions by adding the user to the respective groups as per your use case."}),"\n",(0,n.jsx)(t.h2,{id:"allow-user-to-connect-through-winrm",children:"Allow user to connect through WinRM"}),"\n",(0,n.jsxs)(t.p,{children:["To enable the user to connect through WinRM, the user needs to be in Remote Management Users user group. This will enable the user to connect and by default to run PowerShell commands. In case you need to specify the permissions specifically, run the following script on the server and make sure that the user has at least ",(0,n.jsx)(t.code,{children:"Read"})," and ",(0,n.jsx)(t.code,{children:"Execute"})," permissions:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-powershell",children:'# Specify the username you want to add to the group\n$userToAdd = "YourUsername"\n\n# Specify the session configuration name\n$sessionConfigurationName = "Microsoft.PowerShell"\n\n# Get the current security descriptor for the specified session configuration\n$securityDescriptor = Get-PSSessionConfiguration -Name $sessionConfigurationName | Get-PSSessionConfiguration -ShowSecurityDescriptorUI\n\n# Add the user to the "Remote Management Users" group with Read and Execute permissions\n$remoteManagementUsersGroup = New-Object System.Security.Principal.NTAccount("Remote Management Users")\n$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule($userToAdd, "Read, Execute", "Allow")\n$securityDescriptor.Access.Add($accessRule)\n\n# Set the modified security descriptor back to the session configuration\nSet-PSSessionConfiguration -Name $sessionConfigurationName -SecurityDescriptorSddl $securityDescriptor.Sddl\n'})}),"\n",(0,n.jsx)(t.p,{children:"You can display the current security descriptor for the session configuration by running the following command:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-powershell",children:"Set-PSSessionConfiguration -ShowSecurityDescriptorUI -Name Microsoft.PowerShell\n"})}),"\n",(0,n.jsx)(t.h2,{id:"active-directory-permissions",children:"Active Directory permissions"}),"\n",(0,n.jsxs)(t.p,{children:["The user needs ",(0,n.jsx)(t.code,{children:"Read"})," permissions on the Active Directory objects in ",(0,n.jsx)(t.code,{children:"CN=Certificate Templates, CN=Public Key Services, CN=Services"})," in ",(0,n.jsx)(t.code,{children:"Configuration Naming"})," Context. These permissions should be present by default as Authenticated Users. It can be validated using the following command:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-powershell",children:'Import-Module ActiveDirectory\nGet-Acl -Path "AD:\\CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=YourDomain,DC=com" | Format-List\n\nPath   : Microsoft.ActiveDirectory.Management\\ActiveDirectory:://RootDSE/CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=YourDomain,DC=com\nOwner  : YourDomain\\Enterprise Admins\nGroup  : YourDomain\\Enterprise Admins\nAccess : NT AUTHORITY\\Authenticated Users Allow\n         NT AUTHORITY\\SYSTEM Allow\n         YourDomain\\Enterprise Admins Allow\n         YourDomain\\Domain Admins Allow\nAudit  :\nSddl   : ...\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Make sure to replace ",(0,n.jsx)(t.code,{children:"YourDomain"})," with the actual name of your domain. If the Active Directory module is not installed on your machine, you may need to install it or run the command on a machine where the module is available."]}),"\n",(0,n.jsx)(t.p,{children:"If you're running this on a domain controller, you may not need to import the module explicitly. However, on other machines, you might need to import it to access the Active Directory cmdlets."}),"\n",(0,n.jsx)(t.h2,{id:"adcs-permissions",children:"ADCS permissions"}),"\n",(0,n.jsxs)(t.p,{children:["The created user needs to have permissions to ",(0,n.jsx)(t.code,{children:"Request"}),", ",(0,n.jsx)(t.code,{children:"Issue"})," and ",(0,n.jsx)(t.code,{children:"Read"})," certificates on the certification authority."]}),"\n",(0,n.jsxs)(t.p,{children:["To configure the proper permissions for a user you can use the ",(0,n.jsx)(t.code,{children:"certutil"})," command-line utility through the PowerShell:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-powershell",children:'# Specify the username you want to grant permissions\n$userToAdd = "YourUsername"\n\n# Specify the Certification Authority common name (CN)\n$caCommonName = "YourCACommonName"\n\n# Grant the user the necessary permissions using certutil\ncertutil -ca.cert "%computername%\\$caCommonName" -repairstore -p "YourCAPassword" -users $userToAdd:RSWREAD+RSWENROLL\n'})}),"\n",(0,n.jsx)(t.p,{children:"Make sure to replace the following placeholders with your actual information:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"YourUsername"}),": Replace this with the username for which you want to grant permissions."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"YourCACommonName"}),": Replace this with the common name of your Certification Authority."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"YourCAPassword"}),": Replace this with the password for your CA."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["This command uses ",(0,n.jsx)(t.code,{children:"certutil"})," to configure permissions on the CA for the specified user. The permissions specified are ",(0,n.jsx)(t.code,{children:"RSWREAD (Read)"})," and ",(0,n.jsx)(t.code,{children:"RSWENROLL (Request, Issue)"}),". Note that you might need administrative privileges to run this command, and it's important to handle CA-related tasks with caution."]}),"\n",(0,n.jsx)(t.p,{children:"Additionally, you may need to run this command on the machine where the CA is installed or have appropriate permissions to manage the CA remotely."})]})}function l(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},11151:(e,t,i)=>{i.d(t,{Z:()=>c,a:()=>o});var n=i(67294);const s={},r=n.createContext(s);function o(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);